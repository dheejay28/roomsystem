<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserve Room</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <img src="logo.png" alt="Logo" class="logo">
        <h1>Reserve a Room</h1>
        <div class="datetime" id="datetime"></div>

        <form id="reserve-form">
            <label for="username">Name:</label>
            <input type="text" id="username" required>
            <label for="room-select">Select Room:</label>
            <select id="room-select" required></select>
            <label for="start-time">Start Time:</label>
            <input type="time" id="start-time" required>
            <label for="end-time">End Time:</label>
            <input type="time" id="end-time" required>
            <button type="submit">Reserve Room</button>
        </form>

        <div class="reservation-code" id="reservation-code" style="display:none;"></div>
    </div>

    <script>
        // Load rooms from localStorage
        function loadRooms() {
            const rooms = JSON.parse(localStorage.getItem('rooms')) || [];
            const roomSelect = document.getElementById('room-select');
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room;
                option.textContent = room;
                roomSelect.appendChild(option);
            });
        }

        // Display current date and time
        function updateDateTime() {
            const now = new Date();
            document.getElementById('datetime').textContent = `Current Time: ${now.toLocaleString()}`;
        }

        document.getElementById('reserve-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const username = document.getElementById('username').value.trim();
            const roomName = document.getElementById('room-select').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;

            const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
            const reservationCode = Math.random().toString(36).substring(2, 8).toUpperCase(); // Generate a unique reservation code

            // Check if the room is already reserved during the selected time
            const isRoomReserved = reservations.some(reservation => 
                reservation.roomName === roomName &&
                ((startTime >= reservation.startTime && startTime < reservation.endTime) ||
                (endTime > reservation.startTime && endTime <= reservation.endTime))
            );

            if (isRoomReserved) {
                alert('The selected room is already booked during this time.');
            } else {
                // Add the reservation
                reservations.push({
                    roomName: roomName,
                    username: username,  // Store the username
                    startTime: startTime,
                    endTime: endTime,
                    reservationCode: reservationCode
                });
                localStorage.setItem('reservations', JSON.stringify(reservations)); // Store updated reservations in localStorage

                // Display reservation code
                const reservationCodeDisplay = document.getElementById('reservation-code');
                reservationCodeDisplay.textContent = `Your reservation code: ${reservationCode}`;
                reservationCodeDisplay.style.display = 'block';

                // Reset the form after reserving
                document.getElementById('reserve-form').reset();
                loadRooms(); // Refresh the room list
            }
        });

        // Initialize the page
        window.onload = function() {
            loadRooms();
            updateDateTime();
        };
    </script>
</body>
</html>
